<!DOCTYPE html><html data-current="" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>ASMR by vaccination status</title><meta name="description" content="This sets the meta description in the head of the page. You can watch the output in the browser or in the generated file _site/about.html. "><link rel="stylesheet" href="/assets/main.css"> <script async src="/assets/js/menu.js"></script></head><body><header> <a href="#main" class="show-on-focus" tabindex="1">Skip to content</a><h1> <a href="/" tabindex="2">By Josh</a></h1><nav class="site-nav"> <input type="checkbox" id="nav-trigger" class="nav-trigger" /> <label for="nav-trigger"> <span class="menu-icon"> <svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" /> </svg> </span> </label><div class="trigger"><ul class="disclosure-nav" aria-roledescription="navigation"><li> <a class="top-level main-link" href="/" tabindex="0">Home</a></li><li> <a class="top-level main-link" href="/blog" tabindex="0">Blog</a></li><li> <a class="top-level main-link" href="/about" tabindex="0">About</a></li><li> <a class="top-level main-link" href="/contact" tabindex="0">Contact</a></li><li> <a class="top-level main-link" href="/pandemic-overview" tabindex="0">Pandemic</a> <noscript> <!-- This is to select the button if there is no JS on the page --> </noscript> <button class="menu-button-no-text" type="button" aria-expanded="true" aria-controls="id_Pandemic" aria-label="More Pandemic pages"></button><ul id="id_Pandemic"><li> <a href="pandemic-scientific-papers" tabindex="0">Scientific papers</a></li><li> <a href="pandemic-private-risk-appetite-public-health" tabindex="0">Risk appetite & public health</a></li><li> <a href="/asmr-by-vaccination-status" data-current="current page" tabindex="0">ASMR by vaccination status</a></li></ul></li><li> <a class="top-level main-link" href="/resources" tabindex="0">Resources</a> <noscript> <!-- This is to select the button if there is no JS on the page --> </noscript> <button class="menu-button-no-text" type="button" aria-expanded="true" aria-controls="id_Resources" aria-label="More Resources pages"></button><ul id="id_Resources"><li> <a href="/tech-humour" tabindex="0">Tech humour</a></li></ul></li><li> <a class="top-level main-link" href="/do-better" tabindex="0">Do Better</a></li></ul></div></nav></header><main id="main"><h2>ASMR by vaccination status</h2><p class="tocskiplink"><a href="#toc-skipped">Skip table of contents</a></p><nav> <details open=""> <summary class="no_toc"><h2 class="toc">Table of Contents</h2></summary><ul id="markdown-toc"><li><a href="#age-standardised-mortality-by-vaccination-status" id="markdown-toc-age-standardised-mortality-by-vaccination-status">Age standardised mortality by vaccination status</a></li><li><a href="#confidence-intervals-for-the-novice" id="markdown-toc-confidence-intervals-for-the-novice">Confidence intervals for the novice</a></li><li><a href="#the-data" id="markdown-toc-the-data">The data</a></li><li><a href="#the-graphs" id="markdown-toc-the-graphs">The graphs</a></li><li><a href="#discussion" id="markdown-toc-discussion">Discussion</a></li><li><a href="#the-code" id="markdown-toc-the-code">The code</a></li></ul></details></nav><div id="toc-skipped"></div><h2 id="age-standardised-mortality-by-vaccination-status">Age standardised mortality by vaccination status</h2><p>At the bottom is R code to produce age standardised mortality rate (ASMR) by vaccination status plots for the data source.</p><h2 id="confidence-intervals-for-the-novice">Confidence intervals for the novice</h2><details open=""> <summary><em>click to close this explanation if familiar with error bars and confidence intervals</em> </summary> The vertical lines with bars at the ends above and below the lines on the graph are <a href="https://en.wikipedia.org/wiki/Error_bar">error bars</a> showing the 95% <a href="https://en.wikipedia.org/wiki/Confidence_interval">confidence interval</a>.<p> In other words: non-overlapping 95% confidence intervals for two groups (where the vertical error bars do not overlap) signify that 19 times out of 20 (or more frequently) the lack of overlap signals we would be right in thinking there is a real difference between the groups. Whereas when the confidence intervals overlap we would be less sure of being right if we assert the two groups are different - rather than the difference we are seeing in the sample being a product of the same underlying group value with random variation being the cause of the apparent difference.<p> As examples in the 18-39yr olds second dose at least 21 days ago vs unvaccinated graph below:<ul><li> for March, April, May 2022 all cause and non COVID-19 deaths have lines and confidence intervals that are all close together. We cannot reject the idea that the groups face the same risk of death during these months from these cause categories and the differences seen are due to random variation.<li> for December 2021 those meeting the criteria for deaths involving COVID-19 (see below) have clearly distinct lines with clearly non-overlapping confidence intervals - we can reject the idea that that risk of death while with an acute COVID infection (my reading of the definition in next section) is the same for both groups.</ul></details><h2 id="the-data">The data</h2><p>Following graphs are of data from <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland">ONS deaths by vaccination status, England</a> - specifically <a href="https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland/deathsoccurringbetween1january2021and31may2022/referencetable06072022accessible.xlsx">Table 2: Monthly age-standardised mortality rates by vaccination status by age group for all cause deaths, deaths involving COVID-19 and deaths not involving COVID-19, per 100,000 person-years, England, deaths occurring between 1 January 2021 and 31 May 2022 in the version to 31st May edition</a> (ONS data under <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government v3 license</a>).</p><p>Deaths involving COVID-19: are deaths involving COVID-19 (not “due to COVID-19” which indicates it was the underlying cause in ONS terminology). From the <a href="https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland/deathsoccurringbetween1january2021and31may2022/referencetable06072022accessible.xlsx">definition sheet</a>:-</p><blockquote><p>For this analysis we define a death as involving COVID-19 if either of the ICD10 codes U07.1 (COVID-19, virus identified) or U07.2 (COVID-19, virus not identified) is mentioned on the death certificate. In contrast to the definition used in the weekly deaths released, deaths where the ICD10 code U09.9 (Post-COVID condition, where the acute COVID had ended before the condition immediately causing death occurred) is mentioned on the death certificate and neither of the other two COVID-19 codes are mentioned are not included, as they are likely to be the result of an infection caught a long time previously, and therefore not linked to the vaccination status of the person at date of death</p></blockquote><h2 id="the-graphs">The graphs</h2><p><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-1.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-2.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-3.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-4.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-5.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-6.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-7.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-8.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-9.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-10.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-11.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-12.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-13.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-14.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-15.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-16.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-17.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-18.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-19.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-20.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-21.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-22.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-23.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-24.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-25.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-26.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-27.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-28.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-29.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-30.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-31.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-32.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-33.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-34.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-35.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-36.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-37.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-38.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-39.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-40.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-41.svg" width="100%" /><a href="#main" class="totop">Back to top</a><br /><img src="/assets/img/uploads/asmr-by-vaccination-status_files/ASMR by vaccination status-42.svg" width="100%" /></p><h2 id="discussion">Discussion</h2><p>The theme to this discussion it is that the above graphs don’t really contradict the body of scientific evidence on the vaccine (which says the vaccine does produce differences &amp; is effective while also being capable of causing serious complications but at a much lower rate than serious complications from a COVID-19 infection) and at the same time one cannot think that a difference seen in the graphs is wholly or necessarily due to the vaccine - rather than due to group differences in what kind of person would have a particular vaccination status at a particular point in time.</p><p>The above graph comparing 60 to 69yr olds who are unvaccinated vs. those with a 2nd dose at least 21 days ago shows a common issue with looking at mortality rate by vaccination status: self-selection effects.</p><p>One might think from the rise in all cause mortality in December 2021 among the vaccinated compared to the unvaccinated: uh-oh, maybe the antivaxers are right. But the issue - evidenced by the larger errorbars - is actually people in that age group who have only had a 2nd dose (as compared to a third dose that was available under the autumn booster campaign) are becoming quite rare. That rarity shows up as larger error bars - in <a href="https://crumplab.com/statistics/04-SamplesPopulations.html#estimating-a-confidence-interval">a standard formula for a confidence interval - based on a t-distribution - the size of the interval is inversely proportional to the square root of the sample size while proportional to the standard deviation</a> - so for same standard deviation one can infer a smaller sample size from a larger confidence interval and in this case we do not need inference - <a href="https://www.gov.uk/government/statistics/national-flu-and-covid-19-surveillance-reports-2021-to-2022-season">from the uptake statistics one can see that even by mid December 2022 those who are double vaccinated but not triple vaccinated in that age group consists of a minority - i.e. a smaller sample</a> . And the things that have people in that group might be things that do not help their mortality rate. For instance: scepticism of doctors might obviously lead to them missing treatment until it is too late, or the lack of vaccination may reflect living in an under-served area or having mobility issues - both of which might affect ability to access both the vaccine - and other medical care (with lack of this other medical care driving the higher all cause mortality).</p><p>Given the body of evidence regarding vaccines and the overall picture in the graphs that a doubling of all cause mortality in the unvaccinated compared to vaccinated see an increase greater than a doubling of deaths involving COVID-19 we can discard the idea that higher deaths involving COVID-19 is due entirely to hospital aquired COVID-19 - that the unvaccinated get through need for more frequent admissions for non-COVID related reasons. But that doesn’t mean that the entire difference between the groups seen in the graphs above is due to the effect of the vaccine alone - for instance the vaccinated groups may also have greater ability to shield themselves from infection - e.g. by working from home or being able to afford high quality masks - or greater propensity (e.g. by social distancing and wearing masks).</p><h2 id="the-code">The code</h2><p>The <code class="language-plaintext highlighter-rouge">deaths_vaccination_prep_func</code> allows one to select the age group of interest. Then the <code class="language-plaintext highlighter-rouge">mortality_graph_func</code> takes the prepared data for the age group and you give it the two vaccination statuses you wish to compare.</p><div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set earlier the following line to put output dev to svg</span><span class="w">
</span><span class="c1"># knitr::opts_chunk$set(dev = 'svg')</span><span class="w">
</span><span class="c1"># set following for good graphics output in R markdown - width, fig height &amp; width in inches and svg as output format</span><span class="w">
</span><span class="c1"># out.width='100%', fig.height=5, fig.width=11, fig.ext='svg' </span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">


</span><span class="n">referencetable06072022accessible</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"referencetable06072022accessible.xlsx"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Table 2"</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">


</span><span class="n">deaths_vaccination_prep_func</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">group</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">asmr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">replace_na</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Age-standardised mortality rate / 100,000 person-years`</span><span class="p">),</span><span class="m">0</span><span class="p">))</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%02d"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">month.name</span><span class="p">))),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="s2">"-"</span><span class="p">)</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">cause</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Cause of Death`</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Deaths involving COVID-19"</span><span class="p">,</span><span class="s2">"Non-COVID-19 deaths"</span><span class="p">,</span><span class="s2">"All causes"</span><span class="p">))))</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">lcl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">replace_na</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Lower confidence limit`</span><span class="p">),</span><span class="m">0</span><span class="p">))</span><span class="w">
    </span><span class="n">data</span><span class="o">$</span><span class="n">ucl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">replace_na</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Upper confidence limit`</span><span class="p">),</span><span class="m">0</span><span class="p">))</span><span class="w">
    </span><span class="n">outputdata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">asmr</span><span class="p">,</span><span class="n">cause</span><span class="p">,</span><span class="n">lcl</span><span class="p">,</span><span class="n">ucl</span><span class="p">,</span><span class="n">`Age group`</span><span class="p">,</span><span class="n">`Vaccination status`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">`Age group`</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">group</span><span class="p">)</span><span class="w">
    
    
    
    </span><span class="n">outputdata</span><span class="w">
    
</span><span class="p">}</span><span class="w">

</span><span class="n">mortality_graph_func</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w">
  </span><span class="c1">## status1 and status2 are vaccination statuses</span><span class="w">
  </span><span class="c1">## "Unvaccinated" ,</span><span class="w">
  </span><span class="c1">## "First dose, less than 21 days ago" ,  "First dose, at least 21 days ago" </span><span class="w">
  </span><span class="c1">## "Second dose, less than 21 days ago" , "Second dose, at least 21 days ago"</span><span class="w">
  </span><span class="c1">## "Third dose or booster, less than 21 days ago" ,</span><span class="w">
  </span><span class="c1">## "Third dose or booster, at least 21 days ago"</span><span class="w">
  </span><span class="c1">##</span><span class="w">
  </span><span class="n">series_char</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">""</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">for</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Deaths involving COVID-19"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Non-COVID-19 deaths"</span><span class="p">,</span><span class="w"> </span><span class="s2">"All causes"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">series_char</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">series_char</span><span class="p">,</span><span class="n">paste</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="s2">"-"</span><span class="p">,</span><span class="n">v</span><span class="p">),</span><span class="s2">":"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">##print(series_char)</span><span class="w">
  </span><span class="c1">## series_labels = unlist(strsplit(series_char,"\\:"))</span><span class="w">
  
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">`Vaccination status`</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">status1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">`Vaccination status`</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">status2</span><span class="p">)</span><span class="w">
  
  </span><span class="n">data</span><span class="o">$</span><span class="n">series</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Vaccination status`</span><span class="p">,</span><span class="s2">"-"</span><span class="p">,</span><span class="n">factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">cause</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Deaths involving COVID-19"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Non-COVID-19 deaths"</span><span class="p">,</span><span class="w"> </span><span class="s2">"All causes"</span><span class="p">)))</span><span class="w">
  </span><span class="n">series_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">series</span><span class="p">))</span><span class="w">
  </span><span class="c1">##print(series_labels)</span><span class="w">
  </span><span class="c1"># set page margins</span><span class="w">
  </span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">,</span><span class="w"> </span><span class="m">.1</span><span class="p">),</span><span class="w"> </span><span class="n">las</span><span class="w"> </span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># For setting linetype and colour and size and then consolidating into one legend:-</span><span class="w">
  </span><span class="c1"># use of linetype = interaction(series) - interaction for the line type</span><span class="w">
  </span><span class="c1"># and scale_size_manual(name ="Deaths by vaccination status &amp; cause group", values = c(0.9,0.75,0.9, 0.9,0.75,0.9)) +</span><span class="w">
  </span><span class="c1"># and scale_linetype_manual(name ="Deaths by vaccination status &amp; cause group", values = c("solid", "solid", "twodash", "longdash", "solid", "twodash"))</span><span class="w">
  </span><span class="c1"># where the name is identical is key to consolidating and manually labelling the legend</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">asmr</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">series</span><span class="p">),</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">series</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="w"> </span><span class="n">interaction</span><span class="p">(</span><span class="n">series</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">series_labels</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">asmr</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">geom_errorbar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">lcl</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">ucl</span><span class="p">),</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="w"> </span><span class="n">series</span><span class="p">,</span><span class="w">  </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">series_labels</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="w"> 
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">`Age group`</span><span class="p">,</span><span class="s2">"year olds"</span><span class="p">,</span><span class="s2">" ASMR per 100k person-years by month"</span><span class="p">),</span><span class="w"> </span><span class="n">subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">))[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="s2">" vs. "</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">status1</span><span class="p">,</span><span class="n">status2</span><span class="p">))[</span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Age standardised mortality rate per 100 thousand person-years"</span><span class="p">,</span><span class="w"> </span><span class="n">las</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="s2">"Deaths by vaccination status &amp; cause group"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"yellow"</span><span class="p">,</span><span class="s2">"lightblue"</span><span class="p">,</span><span class="s2">"green"</span><span class="p">,</span><span class="s2">"orange"</span><span class="p">,</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"purple"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_size_manual</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="s2">"Deaths by vaccination status &amp; cause group"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="m">0.75</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="m">0.75</span><span class="p">,</span><span class="m">0.9</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_linetype_manual</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="s2">"Deaths by vaccination status &amp; cause group"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"solid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"solid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"twodash"</span><span class="p">,</span><span class="w"> </span><span class="s2">"longdash"</span><span class="p">,</span><span class="w"> </span><span class="s2">"solid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"twodash"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="o">=</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="n">plot.subtitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"18-39"</span><span class="p">,</span><span class="s2">"40-49"</span><span class="p">,</span><span class="s2">"50-59"</span><span class="p">,</span><span class="s2">"60-69"</span><span class="p">,</span><span class="s2">"70-79"</span><span class="p">,</span><span class="s2">"80-89"</span><span class="p">,</span><span class="s2">"90+"</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">deaths_vaccination_prep_func</span><span class="p">(</span><span class="n">referencetable06072022accessible</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"First dose, less than 21 days ago"</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"First dose, at least 21 days ago"</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"Second dose, less than 21 days ago"</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"Second dose, at least 21 days ago"</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"Third dose or booster, less than 21 days ago"</span><span class="p">))</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">mortality_graph_func</span><span class="p">(</span><span class="n">test</span><span class="p">,</span><span class="s2">"Unvaccinated"</span><span class="p">,</span><span class="s2">"Third dose or booster, at least 21 days ago"</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div></main><footer> <small><a href="https://github.com/byjosh/jekyll-netlify-boilerplate-accessible-menu">This is a fork</a> (of <a href="https://github.com/danurbanowicz/jekyll-netlify-boilerplate" rel="noopener">Jekyll Netlify Boilerplate</a> that is maintained by <a href="https://www.danurbanowicz.com" rel="noopener">Dan Urbanowicz</a>).</small></footer><script> document.body.style.setProperty('--scroll', "0rem"); document.body.classList.add("with-js"); window.addEventListener('scroll', () => { var scrollamount = (window.pageYOffset / (window.innerHeight * 0.1)); var scroll = "0rem"; if (scrollamount > 0 && scrollamount < 1) { scroll = (scrollamount) + "rem"; } if (scrollamount > 1) { scroll = "1rem"; } document.body.style.setProperty('--scroll', scroll); }, false); </script></body></html>
